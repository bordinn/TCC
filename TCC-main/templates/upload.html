<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FYT – Upload</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='icons/732220.png') }}">
</head>
<body>
  <header>
    <div>FYT – Find Your Talent</div>
    <div>Olá, Coordenador!</div>
  </header>

  <div class="container">
    <label>Selecione a sua área:</label>
    <select id="areaSelect">
      <option>RH</option>
      <option>Contábil</option>
      <option>Jurídico</option>
      <option>TI</option>
      <option>Treinamento</option>
      <option>Compras</option>
    </select>

    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
      <img src="../static/icons/732220.png" alt="CSV icon" style="width: 80px; height: 80px; margin: 20px auto; display: block;" />
    </div>

    <div class="format-info">Em formato .CSV</div>
    <input type="file" id="fileInput" accept=".csv" style="display:none" />
    <div id="nome-arquivo" style="margin-top: 10px; font-weight: bold;"></div>

    <button id="botaoEnviar" style="margin-top: 20px; padding: 10px 20px; font-weight: bold; background-color: #e07b3c; color: white; border: none; border-radius: 5px; cursor: pointer;">
      Enviar Arquivo
    </button>

    <div id="mensagem" style="margin-top: 15px; color: red;"></div>
  </div>

  <script>
    let arquivoSelecionado = null;

    document.getElementById("fileInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      const nomeArquivo = document.getElementById("nome-arquivo");
      const mensagem = document.getElementById("mensagem");
      mensagem.textContent = "";

      if (!file) {
        nomeArquivo.textContent = "";
        arquivoSelecionado = null;
        return;
      }

      const extensao = file.name.split(".").pop().toLowerCase();
      if (extensao !== "csv") {
        mensagem.textContent = "Formato inválido. Envie um arquivo .CSV.";
        nomeArquivo.textContent = "";
        arquivoSelecionado = null;
        return;
      }

      nomeArquivo.textContent = `Arquivo selecionado: ${file.name}`;
      arquivoSelecionado = file;
    });

    document.getElementById("botaoEnviar").addEventListener("click", async function () {
      const mensagem = document.getElementById("mensagem");
      mensagem.style.color = 'red';
      mensagem.textContent = "";

      if (!arquivoSelecionado) {
        mensagem.textContent = "Nenhum arquivo foi selecionado.";
        return;
      }

      try {
        const formData = new FormData();
        formData.append('file', arquivoSelecionado);
        formData.append('area', document.getElementById("areaSelect").value);

        const resposta = await fetch('https://iafyt.app.n8n.cloud/webhook/upload-planilha', {
          method: 'POST',
          body: formData
        });

        if (!resposta.ok) {
          throw new Error("Erro ao enviar para o workflow do n8n");
        }

        mensagem.style.color = 'green';
        mensagem.textContent = "Arquivo enviado com sucesso! Redirecionando...";
        setTimeout(() => {
          window.location.href = "dados";
        }, 4000);

      } catch (erro) {
        console.error(erro);
        mensagem.style.color = 'red';
        mensagem.textContent = "Falha ao enviar o arquivo para o workflow.";
      }
    });
  </script>
</body>
</html>
