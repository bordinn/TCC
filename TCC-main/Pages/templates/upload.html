<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FYT – Upload</title>
  <link rel="stylesheet" href="../static/styles.css" />
  <link rel="icon" href="../static/icons/732220.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <div>FYT – Find Your Talent</div>
    <div>Olá, Coordenador!</div>
  </header>

  <div class="container">
    <label>Selecione a sua área:</label>
    <select id="areaSelect">
      <option>RH</option>
      <option>Contábil</option>
      <option>Jurídico</option>
      <option>TI</option>
      <option>Treinamento</option>
      <option>Compras</option>
    </select>

    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
      <img src="../static/icons/732220.png" alt="Excel icon" style="width: 80px; height: 80px; margin: 20px auto; display: block;" />
    </div>

    <div class="format-info">Em formato .XLS ou .XLSX</div>

    <input type="file" id="fileInput" accept=".xls,.xlsx" style="display:none" />
    <div id="nome-arquivo" style="margin-top: 10px; font-weight: bold;"></div>

    <button id="botaoEnviar" style="margin-top: 20px; padding: 10px 20px; font-weight: bold; background-color: #e07b3c; color: white; border: none; border-radius: 5px; cursor: pointer;">
      Enviar Arquivo
    </button>

    <div id="mensagem" style="margin-top: 15px; color: red;"></div>
    <div id="output"></div>

    <div style="position: fixed; bottom: 20px; right: 20px;">
      <button onclick="window.location.href = 'dados.html'" style="text-decoration: none; background-color: #e07b3c; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; cursor: pointer;">
        Ir para dados
      </button>
    </div>
  </div>

  <script>
    let arquivoSelecionado = null;

    document.getElementById("fileInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      const nomeArquivo = document.getElementById("nome-arquivo");
      const mensagem = document.getElementById("mensagem");
      mensagem.textContent = "";

      if (!file) {
        nomeArquivo.textContent = "";
        arquivoSelecionado = null;
        return;
      }

      const extensao = file.name.split(".").pop().toLowerCase();
      if (!["xls", "xlsx"].includes(extensao)) {
        mensagem.textContent = "Formato inválido. Envie um arquivo .XLS ou .XLSX.";
        nomeArquivo.textContent = "";
        arquivoSelecionado = null;
        return;
      }

      nomeArquivo.textContent = `Arquivo selecionado: ${file.name}`;
      arquivoSelecionado = file;
    });

    document.getElementById("botaoEnviar").addEventListener("click", function () {
      const mensagem = document.getElementById("mensagem");
      mensagem.textContent = "";

      if (!arquivoSelecionado) {
        mensagem.textContent = "Nenhum arquivo foi selecionado.";
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(sheet);

        if (json.length === 0) {
          mensagem.textContent = "A planilha está vazia.";
          return;
        }

        localStorage.setItem("dadosExcel", JSON.stringify(json));
        localStorage.setItem("nomeArquivoExcel", arquivoSelecionado.name);
        mensagem.style.color = 'green';
        mensagem.textContent = "Arquivo processado com sucesso. Dados armazenados.";
      };
      reader.readAsArrayBuffer(arquivoSelecionado);
    });
  </script>
</body>
</html>
